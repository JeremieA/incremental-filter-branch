#!/bin/sh

. "$(cd -- "$(dirname -- "$0")" && pwd -P)/../bootstrap.sh"

initializeRepositories

"${BIN_MAIN}" "${DIR_SOURCE}" '--prune-empty --subdirectory-filter subdir' "${DIR_DESTINATION}"

echo 'Fetching tags'
tags=$(getTagList "${DIR_DESTINATION}")
if itemInList 'tag-01' "${tags}"
then
	printf '%s should not be in tag list:\n%s\n' 'tag-01' "${tags}" >&2
	exit 1
fi
if itemNotInList 'tag-02' "${tags}"
then
	printf '%s should be in tag list:\n%s\n' 'tag-02' "${tags}" >&2
	exit 1
fi
if itemInList 'tag-03' "${tags}"
then
	printf '%s should not be in tag list:\n%s\n' 'tag-02' "${tags}" >&2
	exit 1
fi
